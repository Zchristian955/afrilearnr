---
title: "reprex for failing to print all sections to pdf"
output: learnr::tutorial
runtime: shiny_prerendered
description: >
  Test to see if this stops pdf printing working !
---

```{r setup, include=FALSE}
library(learnr)
knitr::opts_chunk$set(echo = FALSE)

library(sf)               # working with vector data
library(afrilearndata)    # example data
library(tmap)             # static and interactive mapping
library(raster)           # raster manipulation

```


```{css echo=FALSE}

@media print {
  .topicsContainer,
  .topicActions,
  .exerciseActions .skip {
    display: none;
  }
  .topics .tutorialTitle,
  .topics .section.level2,
  .topics .section.level3:not(.hide) {
    display: block;
  }
  .topics {
    width: 100%;
  }
  .tutorial-exercise, .tutorial-question {
    page-break-inside: avoid;
  }
  .section.level3.done h3 {
    padding-left: 0;
    background-image: none;
  }
  .topics .showSkip .exerciseActions::before {
    content: "Topic not yet completed...";
    font-style: italic;
  }
}

```    


## Topic 1

### Exercise 

*Here's a simple exercise with an empty code chunk provided for entering the answer.*

Write the R code required to add two plus two:

```{r two-plus-two, exercise=TRUE}

```

### Exercise with Code

*Here's an exercise with some prepopulated code as well as `exercise.lines = 5` to provide a bit more initial room to work.*

Now write a function that adds any two numbers and then call it:

```{r add-function, exercise=TRUE, exercise.lines = 5}
add <- function() {
  
}
```

## Topic 2

### Exercise with Hint

*Here's an exercise where the chunk is pre-evaulated via the `exercise.eval` option (so the user can see the default output we'd like them to customize). We also add a "hint" to the correct solution via the chunk immediate below labeled `print-limit-hint`.*

Modify the following code to limit the number of rows printed to 5:

```{r print-limit, exercise=TRUE, exercise.eval=TRUE}
mtcars
```

```{r print-limit-hint}
head(mtcars)
```

### Quiz

*You can include any number of single or multiple choice questions as a quiz. Use the `question` function to define a question and the `quiz` function for grouping multiple questions together.*

Some questions to verify that you understand the purposes of various base and recommended R packages:

```{r quiz}
quiz(
  question("Which package contains functions for installing other R packages?",
    answer("base"),
    answer("tools"),
    answer("utils", correct = TRUE),
    answer("codetools")
  ),
  question("Which of the R packages listed below are used to create plots?",
    answer("lattice", correct = TRUE),
    answer("tools"),
    answer("stats"),
    answer("grid", correct = TRUE)
  )
)
```

## A. Outline of this tutorial

This is an entry level introduction to spatial data in R using examples from Africa. It is aimed at those with a little knowledge of R.


### Outline of afrilearnr

This tutorial is part of the [afrilearnr](https://github.com/afrimapr/afrilearnr) package containing tutorials to teach spatial data skills in R with African data. It is part of the [afrimapr](https://afrimapr.github.io/afrimapr.website/) project.


### How this tutorial relates to others in afrilearnr

tutorial name        | outline                                   | recommended order
-------------------- | ----------------------------------------- | ------------------
`intro-to-spatial-r` |   an introduction to spatial data in R | 1 this one
`get-my-data-in`     |    getting your own spatial data into R | 2
`join-admin`         |    dealing with data referenced by names rather than coordinates | 3
`afrilearnr-crash-course` |   gallery of plots & code with minimal explanation | 4

### How to use this tutorial 

Click 'Next Topic' to move between sections, or select section headings on the left. If you want to return the tutorial to its original state you can press 'Start Over' on the upper left.

Through the magic of [learnr](https://rstudio.github.io/learnr/) you can modify the R code in the boxes below and press run to see results.

If you are accessing this from shinyapps, another option is to install [afrilearnr from github](https://github.com/afrimapr/afrilearnr) and run these tutorials locally.

A third option is to create a pdf of the tutorial that you can save and run through by copying the code into an R console.
```{r print2pdf2}
# button can be placed anywhere in the tutorial
# from https://github.com/rstudio/learnr/issues/465#issuecomment-817861943
actionButton("print", "save tutorial to pdf", style="opacity: .7; color: #000;")
```


## B. Spatial data outline

We will start by looking at these spatial data for Africa, shown in the map below. 

1. Capital city locations (points)
1. A highway network (lines)
1. Country boundaries (polygons)
1. Population density (gridded or raster data)

```{r tmap-first-view, echo=FALSE}
#echo=FALSE to not show code in first version 

tmap_mode("plot") # to try to avoid learnr problems with 'view' mode

# tmap_mode("view") #to set to tmap interactive viewing mode

# getting error on deploying to shinyapps
#Error in value[3L] :OGRCreateCoordinateTransformation() returned NULL: PROJ available?
#potential solution
#https://stackoverflow.com/questions/61286108/error-in-cpl-transformx-crs-aoi-pipeline-reverse-ogrcreatecoordinatetrans
#If you save an sf-dataframe with a newer version of GDAL, and then try on a system with an older version of GDAL, the projection info cannot be read properly.
#The solution is to re-set the projection:
#st_crs(data) <- 4326

sf::st_crs(africapitals) <- 4326
sf::st_crs(afrihighway) <- 4326
sf::st_crs(africountries) <- 4326
sf::st_crs(africontinent) <- 4326 #not used yet but just in case

#not the raster layer
#st_crs(afripop2020) <- 4326

tmap::tm_shape(afripop2020) +
    tm_raster(palette = rev(viridisLite::magma(5)), breaks=c(0,2,20,200,2000,25000)) +
tm_shape(africountries) +
    tm_borders("white", lwd = .5) +
    #tm_text("iso_a3", size = "AREA") +
tm_shape(afrihighway) +
    tm_lines(col = "red") + 
tm_shape(africapitals) +
    tm_symbols(col = "blue", alpha=0.4, scale = .6 )+
tm_legend(show = FALSE)
```

